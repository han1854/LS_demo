<nav class="navbar">
    <div class="navbar-container">
        <div class="logo">
            <a href="/">LearnSpace</a>
        </div>

        <div class="nav-links">
            <% const _cp = typeof currentPath !== 'undefined' ? currentPath : ''; %>
            <% const _user = typeof currentUser !== 'undefined' ? currentUser : null; %>
        <% if (!_user) { %>
            <!-- Guest Links -->
            <a href="/courses" class="nav-link <%= _cp.startsWith('/courses') ? 'active' : '' %>">
                <i class="fas fa-graduation-cap"></i> Khóa học
            </a>
            <a href="/blog" class="nav-link <%= _cp === '/blog' ? 'active' : '' %>">
                <i class="fas fa-newspaper"></i> Blog
            </a>
            <div class="auth-buttons">
                <a href="/login" class="btn-text <%= _cp === '/login' ? 'active' : '' %>">Đăng nhập</a>
                <a href="/register" class="btn-primary <%= _cp === '/register' ? 'active' : '' %>">Đăng ký</a>
            </div>

        <% } else if (_user.role === 'student') { %>
            <!-- Student Links -->
            <a href="/courses" class="nav-link <%= _cp.startsWith('/courses') ? 'active' : '' %>">
                <i class="fas fa-compass"></i> Khám phá
            </a>
            <a href="/student/courses" class="my-courses <%= _cp === '/student/courses' ? 'active' : '' %>">
                <i class="fas fa-book"></i> Khóa học của tôi
            </a>
            <button class="profile-toggle" onclick="toggleProfileMenu()">
                <img src="<%= _user.avatar || '/static/images/default-avatar.png' %>" alt="Profile">
            </button>
            <!-- Profile Dropdown Menu -->
            <div class="profile-menu" id="profileMenu">
                <a href="/student/dashboard">
                    <i class="fas fa-columns"></i> Bảng điều khiển
                </a>
                <a href="/student/profile">
                    <i class="fas fa-user"></i> Hồ sơ
                </a>
                <a href="#" onclick="Auth.logout()">
                    <i class="fas fa-sign-out-alt"></i> Đăng xuất
                </a>
            </div>

        <% } else if (_user.role === 'instructor') { %>
            <!-- Instructor Links -->
            <a href="/instructor/dashboard" class="nav-link <%= _cp === '/instructor/dashboard' ? 'active' : '' %>">
                <i class="fas fa-columns"></i> Bảng điều khiển
            </a>
            <a href="/instructor/courses" class="nav-link <%= _cp === '/instructor/courses' ? 'active' : '' %>">
                <i class="fas fa-chalkboard-teacher"></i> Khóa học
            </a>
            <a href="/instructor/students" class="nav-link <%= _cp === '/instructor/students' ? 'active' : '' %>">
                <i class="fas fa-users"></i> Học viên
            </a>
            <button class="profile-toggle" onclick="toggleProfileMenu()">
                <img src="<%= _user.avatar || '/static/images/default-avatar.png' %>" alt="Profile">
            </button>
            <!-- Profile Dropdown Menu -->
            <div class="profile-menu" id="profileMenu">
                <a href="/instructor/earnings">
                    <i class="fas fa-coins"></i> Doanh thu
                </a>
                <a href="/instructor/profile">
                    <i class="fas fa-user"></i> Hồ sơ
                </a>
                <a href="#" onclick="Auth.logout()">
                    <i class="fas fa-sign-out-alt"></i> Đăng xuất
                </a>
            </div>

        <% } else if (_user.role === 'admin') { %>
            <!-- Admin Links -->
            <a href="/admin/dashboard" class="nav-link <%= _cp === '/admin/dashboard' ? 'active' : '' %>">
                <i class="fas fa-chart-line"></i> Dashboard
            </a>
            <a href="/admin/users" class="nav-link <%= _cp === '/admin/users' ? 'active' : '' %>">
                <i class="fas fa-users-cog"></i> Người dùng
            </a>
            <a href="/admin/courses" class="nav-link <%= _cp === '/admin/courses' ? 'active' : '' %>">
                <i class="fas fa-graduation-cap"></i> Khóa học
            </a>
            <button class="profile-toggle" onclick="toggleProfileMenu()">
                <img src="<%= _user.avatar || '/static/images/default-avatar.png' %>" alt="Profile">
            </button>
            <!-- Profile Dropdown Menu -->
            <div class="profile-menu" id="profileMenu">
                <a href="/admin/categories">
                    <i class="fas fa-tags"></i> Danh mục
                </a>
                <a href="/admin/reports">
                    <i class="fas fa-flag"></i> Báo cáo
                </a>
                <a href="/admin/settings">
                    <i class="fas fa-cog"></i> Cài đặt
                </a>
                <a href="#" onclick="Auth.logout()">
                    <i class="fas fa-sign-out-alt"></i> Đăng xuất
                </a>
            </div>
        <% } %>
    </div>
</nav>

<!-- Profile Menu Toggle Script -->
<script>
function toggleProfileMenu() {
    const menu = document.getElementById('profileMenu');
    menu.classList.toggle('show');
}

// Close menu when clicking outside
document.addEventListener('click', function(e) {
    const menu = document.getElementById('profileMenu');
    const toggle = e.target.closest('.profile-toggle');
    if (!toggle && menu.classList.contains('show')) {
        menu.classList.remove('show');
    }
});
</script>
