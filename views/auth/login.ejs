<%- include('../partials/head', { title: 'Đăng nhập' }) %>
<%- include('../partials/guest-nav') %>

<div class="auth-container">
    <div class="auth-header text-center">
        <h2>Welcome Back</h2>
        <p>Login to continue learning</p>
    </div>

    <form id="loginForm" class="form">
        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" required>
        </div>

        <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" required>
        </div>

        <div class="error-message" id="errorMessage"></div>
        <button type="submit" class="btn w-100">Login</button>
    </form>

    <div class="auth-links text-center">
        <a href="/forgot-password">Forgot Password?</a>
        <p>Don't have an account? <a href="/register">Sign Up</a></p>
    </div>
</div>

<%- include('../partials/footer') %>

<script>
document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const errorMessage = document.getElementById('errorMessage');
    errorMessage.style.display = 'none';
    
    try {
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();

        const data = await Auth.login(email, password);
        
        switch (data.user.role) {
            case 'admin': window.location.href = '/admin/dashboard'; break;
            case 'instructor': window.location.href = '/instructor/dashboard'; break;
            case 'student': window.location.href = '/student/dashboard'; break;
            default: window.location.href = '/';
        }
    } catch (err) {
        errorMessage.textContent = err.body?.message || 'Login failed. Please try again.';
        errorMessage.style.display = 'block';
    }
});
</script>
